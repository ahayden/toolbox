ARG source_repo
FROM ${source_repo}:user

ARG container_user
RUN test -n "${container_user}"

USER root

RUN apt-get update -qq -y && apt-get install --no-install-recommends -qq -y \
        python3 python3-pip python3-dev python3-setuptools awscli \
        golang gcc g++ jq xxd ruby ruby-dev make man-db \
    && apt-get -y autoclean \
    && apt-get -y autoremove \
    && rm -rf /var/lib/apt/lists/*

RUN gem install travis --no-document

WORKDIR /tmp

RUN curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb" -o "session-manager-plugin-amd64.deb"

RUN curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb" -o "session-manager-plugin-arm64.deb"

USER ${container_user}

COPY git-init /home/${container_user}/git-init
